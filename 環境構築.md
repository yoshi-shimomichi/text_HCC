//：ターミナル操作
#：ファイル内記載

mkdir 自分で開発するアプリの名前
// touch Dockerfile


# Dockerfile
ARG RUBY_VERSION=ruby:3.2.2
ARG NODE_VERSION=19

FROM $RUBY_VERSION
ARG RUBY_VERSION
ARG NODE_VERSION
ENV LANG C.UTF-8
ENV TZ Asia/Tokyo
RUN curl -sL https://deb.nodesource.com/setup_${NODE_VERSION}.x | bash - \
&& wget --quiet -O - /tmp/pubkey.gpg https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \
&& echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list \
&& apt-get update -qq \
&& apt-get install -y build-essential nodejs yarn
RUN mkdir /app
WORKDIR /app
RUN gem install bundler
COPY Gemfile /app/Gemfile
COPY Gemfile.lock /app/Gemfile.lock
COPY yarn.lock /app/yarn.lock
RUN bundle install
RUN yarn install
COPY . /app
#

// touch compose.yml

# compose.yml
services:
  db:
    image: postgres:latest
    platform: linux/amd64
    environment:
      TZ: Asia/Tokyo
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - 5432:5432
  web:
    build: .
    command: bash -c "rm -f tmp/pids/server.pid && bundle exec rails s -p 3000 -b '0.0.0.0'"
    tty: true
    stdin_open: true
    volumes:
      - .:/app
      - bundle_data:/usr/local/bundle:cached
      - node_modules:/app/node_modules
    environment:
      TZ: Asia/Tokyo
    ports:
      - "3000:3000"
    depends_on:
      - db
volumes:
  postgres_data:
  bundle_data:
  node_modules:
#

// touch Gemfile Gemfile.lock yarn.lock

# Gemfile
# frozen_string_literal: true

source "https://rubygems.org"

gem "rails", "~> 7.0.0"
#

// docker compose run --rm web rails new . -d=postgresql -j=esbuild -c=sass

処理中に
// Overwrite /app/Gemfile? (enter "h" for help) [Ynaqdhm]
が出たら[y]を入力

→ひとしきりのファイルが生成される（docker compose buildが必要？）

# config/database.yml
default: &default
  adapter: postgresql
  encoding: unicode
  # For details on connection pooling, see Rails configuration guide
  # https://guides.rubyonrails.org/configuring.html#database-pooling
  pool: <%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %>
  # 追記
  host: db
  username: postgres
  password: password
  # ここまで
#

# Procfile.dev
# デバッグツールが使いやすくよう以下に全て書き替え
js: yarn build --watch
css: yarn build:css --watch
#

// docker compose build

完了？